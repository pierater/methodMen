
---
title: "Determining text data relation to Hip-Hop artist lyrics"
author: "Benito Sanchez, Sammuel Villavicencio, Martin Almaraz"
date: "May 12, 2017"
output: html_document
---


```{r global_options, include=FALSE}
knitr::opts_chunk$set(prompt=TRUE, comment="", echo=TRUE)
```

Given top 100 Hip-Hop artist lyrical data, we plan to create and compare both 
the usage of a Knn classifier and classification tree

## Data exploration
```{r}

# read origional csv file
# the file is very large, ~93mb so we will need to do a lot of cleanup
data = read.csv("lyrics.csv")

# the data file is extremely large, and full of a lot of data we do not need
nrow(data)

# it also includes many collumns that are unimportant to us
names(data)
# We can remove index, year, genre, and X as they will not help us

```

## Preproccessing and data munging
```{r}

# since our data includes many genres of music, we will need to remove anything but Hip-Hop
data = data[data$genre == "Hip-Hop",]

# we will also need to remove any unessesary collumns in the data.frame
data$index = NULL
data$year = NULL
data$genre = NULL
data$X = NULL
data$song = NULL


# now we will further reduce our data set to only the top 100 artists that we have data for
top = names(head(sort(table(data$artist), decreasing=TRUE), 100))
artists = data$artist

# remove all but top 100 artists
data = data[is.element(artists, top),]
data = data[!(data$lyrics == ''),]

```


## Create helper functions for creating ngrams, sorting and generating features from our data
Since we only have lyrics per song and artist, we need to create more features to work with.

Some noteable features we can create are:
    number of words per song
    number of commas per song
    number of unique words per song
    number of lines per song

So we created functions to calculate these features and add them to the current data
```{r}

# get number of words per lyric
get_num_words_in_lyric = function(lyric) {
    return(sapply(gregexpr("\\W+", lyric), length) + 1)
}

# get number of commas per song
get_num_of_commas = function(lyric) {
    return (str_count(lyric, ','))
}

# number of unique words used per song
get_num_unique_words = function(lyric) {
    return(length(table(get_words(lyric))))
}

# get number of lines per song
get_num_lines = function(lyric) {
    return(str_count(lyric, '\n') + 1)
}

# get number of words per line per song
get_words_per_line = function(lyric) {
    return(mean(sapply(unlist(strsplit(lyric, '\n', fixed=TRUE)), get_num_words_in_lyric)))
}

# add these new features to our data frame
create_data = function(data) {
    data$words_line = sapply(data[,"lyrics"], get_words_per_line)
    data$num_lines = sapply(data[,"lyrics"], get_num_lines)
    data$num_unique = sapply(data[,"lyrics"], get_num_unique_words)
    data$num_commas = sapply(data[,"lyrics"], get_num_of_commas)
    data$num_words_total = sapply(data[,"lyrics"], get_num_words_in_lyric)
    return(data)
}

data = create_data(data)
```

## Creating our models Knn and classification tree
```{r}

# create models
library(rpart)
library(rpart.plot)
source('lin-regr-util.R')

x = split_data(data)
tr_dat = x[[1]]
te_dat = x[[2]]

```

## Evaluating the Knn model
```{r}
# make a graph
# do a summary
# test accuracy
```

## Evaluating the classification tree model
```{r}
# make a graph
tree = rpart(artist ~ ., data = tr_dat, method='class')
prp(tree, extra=106, varlen=-10, main="Decide whether a song is by Eminem or Childish Gambino", box.col=c("brickred", "lightblue")[tree$frame$yval])

# do a summary
summary(tree)

# test accuracy
pred = predict(tree, te_dat, type='class')
table(te_dat$artist, pred)
mean(te_dat$artist == pred)
```
## deciding on what worked best and why
```{r}
# how we will do this?
```
